\chapter{Testowanie i ocena wydajnoœci systemu}

\section{Przygotowanie œrodowiska testowego} 

\subsection{Aplikacja serwerowa}

W celu przygotowania œrodowiska do testów konieczne wygenerowanie schematu bazy danych. W przypadku systemów bucardo oraz replikacji logicznej krok ten nale¿y wykonaæ przed konfiguracj¹ replikaji. 

Poprzez zmianê parametru adresu do bazy danych w pliku konfiguracyjnym nale¿y wygenerowaæ schemat na ka¿dym z serwerów. W celu aktualizacji schematu przez Hibernate konieczne jest ustawienie parametru \texttt{hibernate.hbm2ddl.auto} w pliku \texttt{application.properties} na wartoœæ \texttt{update}. Zapis z prawid³owego uruchomienia aplikacji wygl¹da nastêpuj¹co: 

\begin{figure}[H]
\centering
\includegraphics[width=\columnwidth]{{{img/jpa}}}%
\caption{Tworzenie tabel przy pomocy frameworka Hibernate}
\label{}
\end{figure}

\subsection{JMeter} 

Przygotowanie planu testów w aplikacji JMeter rozpoczyna siê od stworzenia konfiguracji po³¹czenia z baz¹ danych. Oprócz danych do po³¹czenia konieczne jest zdefiniowanie nazwy u¿ywanej w póŸniejszej konfiguracji do powi¹zania testów z konfiguracj¹, w tym wypadku zdefiniowan¹ nazw¹ jest '1'.  

\begin{figure}[H]
\centering
\includegraphics[width=8cm]{{{img/jmeter_connection}}}%
\caption{JMeter - po³¹czenie z baz¹ danych}%
\label{jmeter1}%
\end{figure}

Kolejnym krokiem jest konfiguracja symulowanej liczby liczby u¿ytkowników, którzy wykonuj¹ zapytania w tym samym czasie. Zgodnie ze specyfikacj¹ testów zdefiniowane zosta³y grupy zawieraj¹ce 1, 5, 10, 25 i 40 u¿ytkowników dla ka¿dego z czterech badanych zapytañ. 

\begin{figure}[H]
    \centering
    \subfloat[Lista grup]{{\includegraphics[width=3.5cm]{{{img/test_plan}}} }}%
    \qquad
    \subfloat[Przyk³adowa konfiguracja]{{\includegraphics[width=8cm]{{{img/jmeter_users}}} }}%
    \caption{JMeter - konfiguracja liczby aktywnych u¿ytkowników}%
    \label{fig:example}%
\end{figure}


Kolejnym krokiem jest utworzenie zmiennych losowych wykorzystywanych w zapytaniach.

\begin{figure}[H]
\centering
\includegraphics[width=8cm]{{{img/jmeter_random}}}%
\caption{JMeter - definicja zmiennych losowych}%
\label{}%
\end{figure}

Ostatnim elementem konfiguracji planu testów jest utworzenie zapytañ JDBC zawieraj¹cych skrypty SQL, które maj¹ zostaæ wykonane na bazie danych. W konfiguracji konieczne jest podanie zdefiniowanej wczeœniej nazwy po³¹czenia.  Przyk³adowe zapytania przedstawiono na poni¿szych rysunkach. 

\begin{figure}[H]
    \centering
    \subfloat[Single select]{{\includegraphics[width=7cm]{{{img/jmeter_single_select}}} }}%
    \quad
    \subfloat[Update]{{\includegraphics[width=7cm]{{{img/jmeter_update}}} }}%
		
		\subfloat[Insert]{{\includegraphics[width=14cm]{{{img/jmeter_insert}}} }}%
    
    \caption{JMeter - definicje zapytañ testowych}%
    \label{}%
\end{figure}

\section{Wyniki pomiarów czasu wykonania zapytañ}

Zaprojektowany plan testowy zosta³ wykonany dla ka¿dego z badanych mechanizmów replikacji. W przypadku aplikacji pgpool zapytania kierowane by³y na serwer pgpool-core, a w przypadku pozosta³ych metod serwery master. Zbadany zosta³ wp³yw rozmiaru danych oraz liczby aktywnych u¿ytkowników na czas odpowiedzi serwera. Czasy zosta³y uœrednione dla oko³o 50 prób na zapytanie, a wyniki zosta³y opisane poni¿ej. 

W wynikach przedstawiony zosta³ czas œredni odpowiedzi na zapytanie oraz jego wspó³czynnik zmiennoœci. Wspó³czynnik zmiennoœci to miara zró¿nicowania rozk³adu cechy. Najczêœciej definiowany jest wzorem:

\Large

$ V = \frac{ \enskip s \enskip }{ \overline{x} },  \quad \overline{x} \neq 0 $

\normalsize gdzie

\quad \indent $ s $ to odchylenie standardowe z próby,

\quad \indent $ \overline{x}$ to œrednia arytmetyczna z próby.

Mierzy on, jak¹ czêœæ œredniej stanowi odchylenie standardowe. W odró¿nieniu od odchylenia standardowego, jest on miar¹ niemianowan¹ oraz wzglêdn¹ zale¿n¹ od œredniej arytmetycznej, dziêki czemu umo¿liwia porównywanie stopnia zró¿nicowania ró¿nych cech statystycznych. Takie porównania nie s¹ mo¿liwe dla miar bezwzglêdnych. Dla celów praktycznych mo¿na podawaæ wartoœæ wspó³czynnika w procentach po przemno¿eniu przez 100. Przyjmuje siê, ¿e cechy o wartoœci zró¿nicowania poni¿ej 10\% s¹ nieistotne statystycznie. \cite{statystyka}


Poni¿sze wykresy przedstawiaj¹ zale¿noœæ czasu odpowiedzi od rodzaju replikacji oraz liczby aktywnych u¿ytkowników. Serie danych przedstawiaj¹ poszczególne tabele o ró¿nym rozmiarze, wed³ug tabeli \ref{row_count}. Wyniki uzyskane w badaniach tabeli A zosta³y pominiête, gdy¿ zawiera³y znaczne b³êdy pomiaru wynikaj¹ce z ustanwiania po³¹czeñ przez aplikacjê testuj¹c¹. 

\subsection{Odczyt wszystkich rekordów}

\subsubsection{Œredni czas odpowiedzi} 
Œrednie czasy odpowiedzi dla testu odczytu wszystkich rekordów w tabeli przedstawiono na wykresie \ref{all_avg}. Badania wykaza³y, ¿e niezale¿nie od wybranej metody replikacji, liczba aktywnych u¿ytkowników ma znacz¹cy wp³yw na czasy odpowiedzi systemu. 

Najlepszym systemem okaza³ siê pgpool, który dla 40 u¿ytkowników osi¹ga wyniki o oko³o 25\% lepsze od pozosta³ych systemów. Analizuj¹c poszczególne serie danych (na wykresie s³upki o jednakowym kolorze) mo¿na zauwa¿yæ, ¿e szybkoœæ wzrostu w zale¿noœci od liczby u¿ytkowników zmienia siê w sposób nieliniowy. Dla tabel o du¿ym rozmiarze, np. H, I, J, zauwa¿alne s¹ znacznie wiêksze ró¿nice pomiêdzy kolejnymi wartoœciami ni¿ dla tabel ma³ych. 

Skupiaj¹c uwagê na poszczególnych kolumnach wykresu w obrêbie jednej liczby u¿ytkowników mo¿na dostrzec, ¿e rozmiar danych powoduje liniowy wzrost œredniego czasu odpowiedzi. Warto równie¿ zauwa¿yæ, ¿e wyniki bucardo dla 1 oraz 5 u¿ytkowników s¹ widocznie gorsze od wyników pozosta³ych mechanizmów.

\subsubsection{Wspó³czynnik zmiennoœci} 

Na wykresie \ref{all_wsp} pokazano wyniki obliczeñ wspó³czynnika zmiennoœci dla testu odczytu wszystkich rekordów w tabeli. Jak widaæ, najwiêksze zró¿nicowanie danych osi¹gaj¹ce od oko³o 50\% do ponad 80\% uzyskano dla mechanizmu pgpool przy obci¹¿eniu jednego u¿ytkownika. Przy wiêkszej liczbie u¿ytkowników wyniki tego mechanizmu s¹ porównywalne do mechanizmów replikacji logicznej oraz strumieniowej i zawieraj¹ siê w przedziale od 10 do 30 procent. W przypadku systemu bucardo liczba u¿ytkowników ma znacz¹cy wp³yw ma zró¿nicowanie danych. Wartoœci wspó³czynnika zmiennoœci uzyskane dla 1, 5 oraz 10 u¿ytkowników s¹ dwukrotnie wy¿sze od pozosta³ych.

Na podstawie wykresu nie da siê jednoznacznie okreœliæ wp³ywu rozmiaru danych na zró¿nicowanie czasu odpowiedzi. 

\begin{sidewaysfigure}
\centering
\vspace{1cm}
\includegraphics[width=\textwidth]{img/plot/all/avg.png}%
\caption{Wykres zale¿noœci œredniego czasu odpowiedzi od metody replikacji i liczby u¿ytkowników dla testu odczytu wszystkich danych}%
\label{all_avg}%
\end{sidewaysfigure}

\begin{sidewaysfigure}
\centering
\includegraphics[width=\textwidth]{img/plot/all/wsp}%
\caption{Wykres zale¿noœci wspó³czynnika zmiennoœci czasu odpowiedzi od metody replikacji i liczby u¿ytkowników dla testu odczytu wszystkich danych}%
\label{all_wsp}%
\end{sidewaysfigure}


\subsection{Odczyt jednego rekordu}

\subsubsection{Œredni czas odpowiedzi} 
Wyniki badañ czasu odczytu pojedynczego rekordu przedstawiono na wykresie \ref{single_avg}. Bez wzglêdu na wybran¹ metodê replikacji danych, czasy uzyskane przy obci¹¿eniu jednego u¿ytkownika s¹ wyraŸnie ni¿sze od pozosta³ych. 

Systemy replikacji strumieniowej i logicznej uzyska³y w tym teœcie nieco lepsze wyniki od systemów bucardo i pgpool. Czasy odpowiedzi w replikacji strumieniowej s¹ najbardziej odporne na zmieniaj¹ce siê obci¹¿enie i uzyskuj¹ zbli¿one wyniki dla wszystkich badanych liczb aktywnych u¿ytkowników, a tak¿e zachowuj¹ najwiêksz¹ stabilnoœæ przy zmieniaj¹cym siê rozmiarze danych. 

W przypadku systemu pgpool uzyskane wyniki s¹ zbli¿one do tych z replikacji strumieniowej pod wzglêdem wielkoœci, jednak wystêpuj¹ w nich znacznie wiêksze wahania przy testach dla tabel o ró¿nych rozmiarach. 

Najgorzej z testem poradzi³ sobie system replikacji logicznej, którego wyniki dla du¿ych obci¹¿eñ s¹ ponad dwukrotnie wiêksze od uzyskanych przez inne systemy. Mo¿na równie¿ zauwa¿yæ bardzo du¿y rozrzut w zale¿noœci od badanej tabeli. 

Najbardziej zaskakuj¹ce s¹ wyniki systemu bucardo, w którego przypadku czasy odpowiedzi osi¹gaj¹ maksymalne wartoœci dla 5 u¿ytkowników i spadaj¹ przy wiêkszych obci¹¿eniach do poziomu porównywalnego z replikacj¹ pgpool i strumieniow¹. 

\subsubsection{Wspó³czynnik zmiennoœci} 

Zale¿noœæ wspó³czynnika zmiennoœci od badanych parametrów pokazano na wykresie \ref{single_wsp}. Po porównaniu tego wykresu z wartoœciami dla poprzedniego testu widaæ, ¿e zró¿nicowanie wyników dla odczytu jednego rekordu jest znacznie wiêksze. System replikacji strumieniowej uzyskuje najbardziej jednolite wyniki, jednak nie jest pozbawiony obserwacji znacznie odbiegaj¹cych od œredniej. Zró¿nicowanie replikacji pgpool dla wiêkszoœci badanych przypadków dorównuje replikacji strumieniowej, jednak zawiera wiêcej odchyleñ. Najbardziej zró¿nicowane wyniki uzyskano z badañ systemów bucardo i replikacji logicznej. Ogólny poziom wartoœci wspó³czynnika zmiennoœci jest w przybli¿eniu dwukrotnie wy¿szy od pozosta³ych systemów. W ka¿dym z analizowanych systemów wystêpuj¹ znacz¹ce wahania poziomu zró¿nicowania danych. 
\begin{sidewaysfigure}
\centering
\includegraphics[width=\textwidth]{img/plot/single/avg}%
\caption{Wykres zale¿noœci œredniego czasu odpowiedzi od metody replikacji i liczby u¿ytkowników dla testu odczytu jednego rekordu}%
\label{single_avg}%
\end{sidewaysfigure}

\begin{sidewaysfigure}
\centering
\includegraphics[width=\textwidth]{img/plot/single/wsp}%
\caption{Wykres zale¿noœci wspó³czynnika zmiennoœci czasu odpowiedzi od metody replikacji i liczby u¿ytkowników dla testu odczytu jednego rekordu}%
\label{single_wsp}%
\end{sidewaysfigure}

\clearpage
\subsection{Zapis rekordu}
\subsubsection{Œredni czas odpowiedzi} 

Pierwsz¹ obserwacj¹, jak¹ mo¿na odczytaæ z wykresu œredniego czasu dla testu zapisu (rys. \ref{insert_avg}) jest to, ¿e system replikacji logicznej jest zdecydowanie wolniejszy od pozosta³ych. Uzyskiwane przez niego wyniki oscyluj¹ od 120 do oko³o 145ms, podczas gdy inne systemy w wiêkszoœci przypadków uzyskuj¹ wyniki poni¿ej 50ms. Wystêpuj¹ te¿ znaczne ró¿nice w czasach dla poszczególnych tabel w obrêbie jednej liczby po³¹czeñ oraz dla ró¿nych liczb po³¹czeñ. 

Mo¿na zauwa¿yæ, ¿e rozmiar danych ma znikomy wp³yw na czas odpowiedzi. Nieco bardziej istotna jest liczba u¿ytkowników, jednak dla badanych poziomów obci¹¿enia ró¿nice s¹ niewielkie. Widoczny jest wzrost w przypadku replikacji strumieniowej i bucardo dla 25 oraz 40 aktywnych po³¹czeñ. 


\subsubsection{Wspó³czynnik zmiennoœci}

Replikacja logiczna, która okaza³a siê osi¹gaæ najgorsze czasy zapisu rekordu jest te¿ najbardziej zró¿nicowana. Wartoœci wspó³czynnika zmiennoœci zawieraj¹ siê w przedziale od 10 do 60 procent. W przypadku pozosta³ych badanych systemów w zdecydowanej wiêkszoœci uzyskanych wyników wartoœæ wspó³czynnika wynosi poni¿ej 10\%. W wynikach systemu bucardo wystêpuj¹ dwa znaczne odchylenia od ogólnego poziomu zró¿nicowania, jednak trudno okreœliæ, czy s¹ one zale¿ne od któregokolwiek z badanych parametrów. 

\begin{sidewaysfigure}
\centering
\includegraphics[width=\textwidth]{img/plot/insert/avg}%
\caption{Wykres zale¿noœci œredniego czasu odpowiedzi od metody replikacji i liczby u¿ytkowników dla testu zapisu}%
\label{insert_avg}%
\end{sidewaysfigure}

\begin{sidewaysfigure}
\centering
\includegraphics[width=\textwidth]{img/plot/insert/wsp}%
\caption{Wykres zale¿noœci wspó³czynnika zmiennoœci czasu odpowiedzi od metody replikacji i liczby u¿ytkowników dla testu zapisu}%
\label{insert_wsp}%
\end{sidewaysfigure}


\subsection{Aktualizacja rekordu}
\subsubsection{Œredni czas odpowiedzi} 

Wyniki tego testu przedstawione zosta³y na rysunku \ref{update_avg}. Podobnie jak w przypadku testu zapisu rekordu, czasy odpowiedzi replikacji logicznej s¹ wy¿sze od pozosta³ych systemów. Wystêpuj¹ ró¿nice dla ró¿nych rozmiarów tabel oraz liczb u¿ytkowników, jednak nie jest mo¿liwe okreœlenie zale¿noœci. System bucardo oraz replikacja strumieniowa uzyska³y najlepsze czasy dla ma³ego obci¹¿enia. W przypadku tych systemów widaæ równie¿ wp³yw liczby u¿ytkowników na czas. Dla 25 i 40 aktywnych po³¹czeñ zaobserwowaæ mo¿na niewielki wzrost. Wp³yw rozmiaru danych na czas aktualizacji jest znikomy, jednak coraz wiêkszy wraz z rosn¹cym obci¹¿eniem. Dla replikacji systemem pgpool wyniki s¹ bardzo zbli¿one dla wszystkich poziomów obci¹¿enia z wyj¹tkiem ostatniego, gdzie zaobserwowaæ mo¿na niewielki wzrost. 


\subsubsection{Wspó³czynnik zmiennoœci}

Wspó³czynniki zmiennoœci dla testu aktualizacji zaprezentowane zosta³y na wykresie \ref{update_wsp}. £atwo zauwa¿yæ, ¿e test ten jest najmniej zró¿nicowany ze wszystkich. Wartoœæ wspó³czynnika osi¹ga tu maksymalnie 27\% dla wszystkich kombinacji badanych parametrów. Znacznie bardziej widoczny jest tu wp³yw liczby u¿ytkowników na zró¿nicowanie wyników. Replikacka bucardo oraz strumieniowa wykazuj¹ sta³y wzrost zró¿nicowania wraz ze zwiêkszaj¹cym siê obci¹¿eniem. Replikacja logiczna, która wykazywa³a siê najgorszymi czasami aktualizacji danych jest te¿ najmniej zró¿nicowana dla obci¹¿enia powy¿ej jednego u¿ytkownika. Przy jednym po³¹czeniu wspó³czynniki osi¹gaj¹ z kolei jedne z wy¿szych wartoœci na tle badanych systemów.

\begin{sidewaysfigure}
\centering
\includegraphics[width=\textwidth]{img/plot/update/avg}%
\caption{Wykres zale¿noœci œredniego czasu odpowiedzi od metody replikacji i liczby u¿ytkowników dla testu aktualizacji rekordu}%
\label{update_avg}%
\end{sidewaysfigure}

\begin{sidewaysfigure}
\centering
\includegraphics[width=\textwidth]{img/plot/update/wsp}%
\caption{Wykres zale¿noœci wspó³czynnika zmiennoœci czasu odpowiedzi od metody replikacji i liczby u¿ytkowników dla testu aktualizacji rekordu}%
\label{update_wsp}%
\end{sidewaysfigure}

\subsection{OpóŸnienie replikacji danych}

\section{Wnioski z testów}
