\chapter{Projekt systemu}

\section{Architektura systemu}
\indent \par
System zostanie podzielony na cztery czêœci:
\begin{itemize}[leftmargin=+2cm]
	\item aplikacjê mobiln¹ na telefony z systemem Android,
	\item aplikacjê internetow¹ realizuj¹c¹ funkcje konsoli administracyjnej 
	\item serwer prowadz¹cy grê
	\item bazê danych
	
\end{itemize}

Aplikacja mobilna bêdzie pe³niæ rolê klienta gry i przeznaczona bêdzie dla graczy. Z jej pomoc¹ u¿ytkownicy bêd¹ mogli odczytywaæ i wykonywaæ przydzielone im zlecenia, edytowaæ swój profil, przegl¹daæ ranking i zarz¹dzaæ swoim kontem. Urz¹dzenie mobilne zostanie wykorzystane do okreœlenia lokalizacji u¿ytkowników na potrzeby gry. 

	Konsola administracyjna s³u¿yæ bêdzie administratorom gry to obserwowania jej przebiegu i modyfikowania parametrów, a tak¿e zarz¹dzania kontami u¿ytkowników. 
	
	Zadaniem serwera jest automatyczne prowadzenie gry bez koniecznoœci udzia³u administratorów systemu. W ramach pracy serwera powinny byæ generowane lub usuwane zlecenia prywatne i publiczne, wysy³ane powiadomienia do graczy, a tak¿e monitorowana aktywnoœæ graczy. Serwer wykorzystywany bêdzie tak¿e do stworzenia interfejsu komunikacyjnego pomiêdzy aplikacjami klienckimi lub konsol¹ administracyjn¹ a baz¹ danych. 
\section{Przypadki u¿ycia} 
\indent \par
Na podstawie sprecyzowanych powy¿ej zasad gry i opisu dzia³ania systemu opracowano przypadki u¿ycia systemu. Diagramy przypadków u¿ycia przedstawiaj¹ rysunki \ref{fig:usecase_1} oraz \ref{fig:usecase_2}.

\begin{figure}[H]
\centering
\includegraphics[width=\columnwidth]{rys04/usecase1.jpg}
\caption{}
\label{fig:usecase_1}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=\columnwidth]{rys04/usecase2.jpg}
\caption{}
\label{fig:usecase_2}
\end{figure}

Poni¿ej znajduj¹ siê przyk³adowe scenariusze opisuj¹ce dzia³ania u¿ytkownika, jakie mog¹ zajœæ podczas korzystania systemu. Ze wzglêdu na zautomatyzowan¹ naturê czêœci serwerowej systemu, opis scenariuszy skupia siê g³ównie na czynnoœciach wykonywanych przez u¿ytkownika aplikacji mobilnej. W scenariuszach zosta³y wyszczególnione sytuacje wyj¹tkowe oznaczaj¹ce b³¹d w podstawowym przebiegu interakcji prowadz¹cy do jej niepoprawnego zakoñczenia oraz przebiegi alternatywne opisuj¹ce inny zestaw kroków prowadz¹cy do tego samego wyniku. 
\begin{enumerate}

\item Rejestracja
\begin{description}
\item[Aktor] \hfill \\
 Niezarejestrowany u¿ytkownik aplikacji
\item[Zdarzenie inicjuj¹ce] \hfill \\
U¿ytkownik bêd¹c na ekranie startowym aplikacji klikn¹³ przycisk „Rejestracja”.
\item[Warunki pocz¹tkowe] \hfill \\
brak
\item[Opis przebiegu interakcji] \hfill \\
\begin{enumerate}
\item W aplikacji wyœwietlany jest ekran Rejestracja.
\item	U¿ytkownik klika przycisk „Wybór zdjêcia”.
		\begin{enumerate}[label*=\arabic*.]
		\item	Na telefonie zostaje otwarta aplikacja do wyboru obrazu
		\item	U¿ytkownik wybiera obraz
		\item	Aplikacja wyœwietla widok pozwalaj¹cy na przyciêcie zdjêcia
		\item	U¿ytkownik ustawia przyciêcie i potwierdza
		\item	Przyciête zdjêcie wyœwietla siê w miejscu przycisku na 	ekranie Rejestracja
		\item	Na zdjêciu wykrywana jest twarz i wyœwietlana jest informacja potwierdzaj¹ca wykrycie twarzy
		\end{enumerate}
\item	U¿ytkownik wype³nia pola tekstowe szablonu rejestracyjnego
		\begin{enumerate}[label*=\arabic*.]
		\item	Po klikniêciu w pole „Data urodzenia” zamiast klawiatury wyœwietla siê kalendarz.
		\item	U¿ytkownik wybiera datê z kalendarza i potwierdza przyciskiem Ok.
		\item	Data zostaje wpisana w polu „Data urodzenia”.
		\end{enumerate}
\item	U¿ytkownik zaznacza pole wyboru „Akceptujê zasady gry”.
\item	U¿ytkownik klika przycisk „Rejestruj”.
\item	Zdjêcie u¿ytkownika jest przesy³ane na serwer.
\item	W miejscu przycisku „Rejestruj” wyœwietlony zostaje pasek postêpu przesy³ania.
\item	Po przes³aniu zdjêcia otrzymywany jest jego identyfikator.
\item	Dane z szablonu wraz z identyfikatorem zdjêcia przesy³ane s¹ na serwer.
\item	Okno rejestracji zamyka siê automatycznie po 4 sekundach i aplikacja powraca do ekranu startowego.
\end{enumerate}
\item[Sytuacje wyj¹tkowe] \hfill \\
Ad. 3.3. Wybrana data urodzenia jest w przysz³oœci. Wyœwietlany jest komunikat o niepoprawnoœci daty.\\*
Ad. 8. Przes³anie zdjêcia nie powiod³o siê. Wyœwietlany jest komunikat o b³êdzie przesy³ania zdjêcia. Nastêpuje powrót do kroku 5.
\item[Przebiegi alternatywne ] \hfill
\begin{enumerate}
\item	Punkty 2., 3. oraz 4. mog¹ zostaæ wykonane w dowolnej kolejnoœci.
 \item	W dowolnym momencie rejestracji u¿ytkownik mo¿e wyœwietliæ zasady gry. Wyœwietlenie zasad nie ma wp³ywu na resztê przebiegu rejestracji. Scenariusz zostaje rozszerzony o kroki:
\begin{enumerate}
\item	U¿ytkownik klika w przycisk „Zasady gry”. 
\item	Wyœwietlone zostaje okno z zasadami. 
\item	U¿ytkownik czyta zasady i klika przycisk „Ok”.
\item	 Okno z zasadami zamyka siê.

\end{enumerate}
\end{enumerate}

\item[Warunki koñcowe] \hfill \\
Zarejestrowane zosta³o nowe konto u¿ytkownika.

\end{description}
%------------------------------------------------------------------------------------------
\item Logowanie

\begin{description}

\item [Aktor]\hfill \\
	U¿ytkownik
\item [Zdarzenie inicjuj¹ce]\hfill \\
	U¿ytkownik bêd¹c na ekranie startowym aplikacji klikn¹³ przycisk „Logowanie”.
\item [Warunki pocz¹tkowe]\hfill \\
U¿ytkownik posiada konto w aplikacji (jest zarejestrowany).
\item [Opis przebiegu interakcji]\hfill
\begin{enumerate}
\item	W aplikacji wyœwietlany jest ekran Logowanie.
\item	U¿ytkownik uzupe³nia pola „nazwa u¿ytkownika” i „has³o”.
\item	U¿ytkownik klika przycisk „Zaloguj”.
\item	Pola tekstowe i przycisk zastêpowane s¹ przez wskaŸnik postêpu.
\item	Dane logowania przesy³ane s¹ przez aplikacjê na serwer.
\item	Serwer sprawdza poprawnoœæ wprowadzonych danych.
\item	Aplikacja otrzymuje token uwierzytelniaj¹cy u¿ytkownika.
\item	Aplikacja przechodzi do widoku Zapis lokalizacji.
\end{enumerate}
\item [Sytuacje wyj¹tkowe ]\hfill \\
Ad. 4. Wprowadzone dane s¹ niepoprawne. Wyœwietlony zostaje komunikat „Niepoprawne dane logowania”. Nastêpuje powrót do kroku 2.
\item [Przebiegi alternatywne ]\hfill \\
	brak
\item [Warunki koñcowe]\hfill \\
	U¿ytkownik zosta³ zalogowany.
	\end{description}
%------------------------------------------------------------------------------------------
\item Zapis lokalizacji u¿ytkownika

\begin{description}
\item [Aktor]\hfill \\
	Aplikacja? 
\item [Zdarzenie inicjuj¹ce] \hfill \\
	U¿ytkownik zosta³ zalogowany (przypadek Logowanie do aplikacji mobilnej)
\item [Warunki pocz¹tkowe] \hfill \\ brak
\item [Opis przebiegu interakcji]  \hfill
\begin{enumerate}
	\item	W aplikacji wyœwietlony zostaje ekran Zapis lokalizacji
	\item	Wyœwietlony zostaje komunikat „Sprawdzanie uprawnieñ”
	\item	Aplikacja sprawdza uprawnienia dostêpu do modu³u GPS telefonu.
	\item	Wyœwietlony zostaje komunikat „Sprawdzanie ustawieñ”
	\item	Aplikacja sprawdza, czy w telefonie w³¹czone s¹ us³ugi lokalizacyjne. 
	\item	Wyœwietlony zostaje komunikat „Oczekiwanie na lokalizacjê”
	\item	Aplikacja rozpoczyna nas³uchiwanie aktualizacji lokalizacji.
	\item	Gdy dok³adnoœæ lokalizacji osi¹gnie 25 m informacje o lokalizacji s¹ przesy³ane na serwer.
	\item	Serwer zapisuje dane do bazy.
	\item	Aplikacja przechodzi do widoku Zlecenia.
\end{enumerate}

\item [Sytuacje wyj¹tkowe]  \hfill \\
Ad. 8.	Nie uda³o siê ustaliæ dok³adnej lokalizacji przez okres 30 sekund. Wyœwietlany jest komunikat „Nie uda³o siê ustaliæ lokalizacji. Spróbuj ponownie póŸniej”.
\item [Przebiegi alternatywne]  \hfill \\
Ad. 3. Aplikacja nie ma uprawnieñ do modu³u GPS telefonu. \\*
Wyœwietlane jest okno dialogowe z proœb¹ o uprawnienia. Nastêpuje powrót do kroku 3.\\*
Ad 5. W telefonie wy³¹czone s¹ us³ugi lokalizacyjne
Wyœwietlane jest okno dialogowe z proœb¹ o zmianê ustawieñ. Otwarte zostaj¹ ustawienia telefonu. Nastêpuje powrót do kroku 5.
\item [Warunki koñcowe] \hfill \\
	Lokalizacja zosta³a zapisana do bazy danych.
\item[Uwagi] \hfill \\
	Aktualizacje lokalizacji nie s¹ zatrzymywane po wykonaniu zapisu.
\end{description}

%------------------------------------------------------------------------------------------


\item Potwierdzenie wykonania zlecenia

\begin{description}
\item [Aktor]\hfill \\
	U¿ytkownik 
\item [Zdarzenie inicjuj¹ce] \hfill \\
	Wyœwietlenie szczegó³ów zlecenia
\item [Warunki pocz¹tkowe] \hfill \\ 
Zlecenie ma status Aktywny
\item [Opis przebiegu interakcji]  \hfill
\begin{enumerate}
	\item	U¿ytkownik wprowadza kod uzyskany od znalezionego u¿ytkownika w odpowiednie pole w widoku Szczegó³y zlecenia
	\item	U¿ytkownik zatwierdza kod przyciskiem Wyœlij
	\item	Aplikacja pobiera lokalizacjê u¿ytkownika i razem z kodem przesy³a dane na serwer
	\item	Na serwerze nastêpuje sprawdzenie, czy wprowadzony kod jest poprawny oraz czy lokalizacje generowania i wprowadzenia kodu znajduj¹ siê w pobli¿u
	\item	Jeœli kod jest poprawny, zlecenie zostaje zatwierdzone. Aplikacja ponownie pobiera zmienione ju¿ dane o zleceniu
	\item	Widok Szczegó³ów zlecenia jest aktualizowany nowymi danymi
\end{enumerate}

\item [Sytuacje wyj¹tkowe]  \hfill \\
Ad. 3. Aktualna lokalizacja u¿ytkownika nie jest dostêpna – przesy³ana jest ostatnia lokalizacja logowania u¿ytkownika.  \\*
Ad 5. Kod jest niepoprawny – przycisk Wyœlij zostaje zablokowany na 10 sekund. W miejscu przycisku pokazuje siê odliczanie czasu. W Zleceniu nie nastêpuj¹ ¿adne zmiany.  \\*

\item [Warunki koñcowe] \hfill \\
Zlecenie zosta³o oznaczone jako wykonane.
\end{description}

%------------------------------------------------------------------------------------------
\item Generowanie kodu

\begin{description}
\item [Aktor]\hfill \\
	U¿ytkownik 
\item [Zdarzenie inicjuj¹ce] \hfill \\
	U¿ytkownik wybra³ pozycjê „Generuj kod” z menu nawigacyjnego aplikacji
\item [Warunki pocz¹tkowe] \hfill \\ 
brak
\item [Opis przebiegu interakcji]  \hfill
\begin{enumerate}
\item	W aplikacji wyœwietlony zostaje widok Generator kodów.
\item U¿ytkownik przytrzymuje przycisk z ikon¹ kostki do gry.
\item W czasie trzymania przycisku wyœwietlana jest animacja ³adowania wokó³ przycisku
\item	Po zakoñczeniu ³adowania generowany jest losowy 6-cyfrowy ci¹g znaków z³o¿ony z du¿ych liter i cyfr.
\item	Wygenerowany kod wyœwietlany jest w odpowiednim polu w aplikacji.
\item	Pobierana jest lokalizacja u¿ytkownika i wraz z wygenerowanym kodem przesy³ana jest na serwer i zapisywana w bazie danych.
\item	Uruchamiane jest odliczanie czasu wa¿noœci kodu.
\end{enumerate}

\item [Sytuacje wyj¹tkowe]  \hfill \\
Ad 3. W przypadku puszczenia przycisku przed zakoñczeniem animacji kod nie jest generowany, animacja jest resetowana do pocz¹tku. Po kolejnym wciœniêciu przycisku ³adowanie rozpoczyna siê od pocz¹tku. \\*

\item [Warunki koñcowe] \hfill \\
Na ekranie aplikacji wyœwietlony zosta³ wygenerowany kod.
\end{description}

%------------------------------------------------------------------------------------------

\item Edycja profilu
\begin{description}
\item [Aktor]\hfill \\
	U¿ytkownik 
\item [Zdarzenie inicjuj¹ce] \hfill \\
	U¿ytkownik klikn¹³ przycisk Edycja profilu w widoku Profil u¿ytkownika
\item [Warunki pocz¹tkowe] \hfill \\ 
brak
\item [Opis przebiegu interakcji]  \hfill
\begin{enumerate}
\item	Pola z informacjami o u¿ytkowniku w aplikacji staj¹ siê edytowalne
\item	Przycisk Edycja profilu zamienia siê w „Zapisz”.
\item	U¿ytkownik zmienia interesuj¹ce go pola
\item	U¿ytkownik zatwierdza zmiany wciskaj¹c przycisk Zapisz
\item	Zmiany s¹ weryfikowane pod k¹tem poprawnoœci podobnie jak przy rejestracji.
\item	Zmiany zostaj¹ przes³ane na serwer i zapisane do bazy danych.
\item	Pola z informacjami ponownie stajê siê nieedytowalne 

\end{enumerate}

\item [Sytuacje wyj¹tkowe]  \hfill \\
Ad 5. Weryfikacja poprawnoœci danych nie powiod³a siê – b³êdnie wprowadzone pola zostaj¹ zaznaczone kolorem czerwonym. Nastêpuje powrót do kroku 3. \\*
	Ad. 6. Nie uda³o siê nawi¹zaæ po³¹czenia z serwerem – wyœwietlony jest komunikat o b³êdzie po³¹czenia. Nastêpuje powrót do kroku 4.\\*
	U¿ytkownik opuœci³ widok Profil u¿ytkownika przed zapisaniem zmian – Wprowadzone zmiany zostaj¹ utracone.\\*

\item [Warunki koñcowe] \hfill \\
Zmiany w profilu u¿ytkownika zosta³y zapisane.
\end{description}

%------------------------------------------------------------------------------------------


\end{enumerate} % wyliczanie przypadków u¿ycia
\newpage
\section{Projekt interfejsu}\indent \par

\subsection{Aplikacja kliencka}\indent \par

Projekt interfejsu aplikacji mobilnej zosta³ wykonany w oparciu o wskazówki \textit{Material design}\ref{material_design} opracowane przez Google.

Po uruchomieniu aplikacji wyœwietlony zostaje ekran powitalny, z którego u¿ytkownik mo¿e przejœæ do logowania lub rejestracji do gry. Z poziomu ekranu powitalnego jest równie¿ mo¿liwoœæ wyœwietlenia zasad gry. Po klikniêcie przycisku Login, wyœwietlony zostaje ekran logowania widoczny na rysunku \ref{fig:login}, a po klikniêciu przycisku Register ekran Rejestracja ( rysunek \ref{fig:register} a) ).
\begin{figure}[H]
\centering
\includegraphics[width=4cm]{rys04/welcome}
\caption{Ekran startowy aplikacji}
\label{fig:welcome}
\end{figure}

Na ekranie rejestracji wyœwietlone s¹ w kolumnie pola tekstowe na informacje o u¿ytkowniku. Pole do wpisania has³a domyœlnie nie pokazuje jawnie wpisywanego tekstu, lecz zastêpuje go kropkami. Na prawo od pola has³a znajduje siê przycisk z ikon¹ oka, po jego naciœniêciu znaki has³a zostan¹ pokazane.

 U góry ekranu znajduje siê miejsce na zdjêcie profilowe u¿ytkownika. Po klikniêciu wewn¹trz ramki u¿ytkownik zostanie przekierowany do odpowiedniej dla jego urz¹dzenia aplikacji galerii w celu wyboru zdjêcia. Po wyborze aplikacja poprosi u¿ytkownika o przyciêcie wybranego zdjêcia do interesuj¹cych rozmiarów. Zdjêcia profilowe muszê byæ kwadratowe. Po zakoñczeniu wybrane zdjêcie zostanie wyœwietlone wewn¹trz ramki.

Po klikniêciu przez uzytkownika w pole \textit{data urodzenia} zamiast standardowej klawiatury wyœwietlone zostanie okno dialogowe z kalendarzem widoczne na rysunku \ref{fig:register} b).

Na górnej krawêdzi ekranu znajduje siê pasek nawigacyjny pozwalaj¹cy na powrót do ekranu startowego aplikacji.

\begin{figure}[H]
\centering
\begin{tabular}{@{}ll@{}}
a) & b) \\
\includegraphics[width=4cm]{rys04/register} &
\includegraphics[width=4cm]{rys04/register2}
\end{tabular}
\caption{a) Ekran rejestracji b) Okno dialogowe kalendarza}
\label{fig:register}
\end{figure}

Ekran logowania zawiera dwa podstawowe pola tekstowe, nazwa u¿ytkownika oraz has³o oraz przycisk logowania. Pod przyciskiem znajduje siê pole wyboru pozwalaj¹ce zapamiêtaæ wpisane dane. Po naciœniêciu przycisku formularz logowania znika, a w jego miejscu pojawia siê wskaŸnik ³adowania. W przypadku b³êdnych danych wyœwietlony zostaje komunikat o b³êdzie. Po poprawnym logowaniu w aplikacji zostaje wyœwietlony ekran Zapis lokalizacji widoczny na rysunku \ref{fig:gps}.

Ponownie umieszczono na górnej krawêdzi ekranu pasek nawigacyjny pozwalaj¹cy na powrót do ekranu startowego aplikacji.

\begin{figure}[H]
\centering
\includegraphics[width=4cm]{rys04/login}
\caption{Ekran logowania }
\label{fig:login}
\end{figure}


Na ekranie Zapis lokalizacji pod umieszczon¹ grafik¹ wyœwietlany jest komunikat o aktualnie wykonywanym zadaniu lub informacja dla u¿ytkownika o dodatkowych czynnoœciach, które nale¿y wykonaæ np. w³¹czenie GPS. Pod komunikatem znajduje siê przycisk pozwalaj¹cy na otwarcie ustawieñ systemowych telefonu, w przypadku gdy u¿ytkownik zamkn¹³ okno dialogowe informuj¹ce o koniecznoœci uaktywnienia modu³u GPS telefonu.

\begin{figure}[H]
\centering
\includegraphics[width=4cm]{rys04/nogps}
\caption{Ekran zapisu lokalizacji po logowaniu}
\label{fig:gps}
\end{figure}


Widok listy zleceñ u¿ytkownika wyœwietlany po zakoñczeniu zapisu lokalizacji podzielony jest na dwie jednakowe sekcje: prywatne i publiczne. W ka¿dej z sekcji znajduje siê lista zleceñ danego typu. Elementy listy zawieraj¹ informacje o u¿ytkowniku bêd¹cym celem zlecenia oraz jego status. Po klikniêciu elementu listy otwarty zostaje widok Szczegó³y zlecenia widoczny na rysku \ref{fig:details}. Na górnym pasku nawigacyjnym znajduje siê przycisk pozwalaj¹cy na pokazanie bocznego panelu nawigacyjnego. Panel nawigacyjny mo¿e te¿ zostaæ przywo³any poprzez przeci¹gniêcie w prawo po ekranie. Wysuniêty panel nawigacyjny widoczny jest na rysunku \ref{fig:drawer}.

\begin{figure}[H]
\centering
\includegraphics[width=4cm]{rys04/targets}
\caption{Lista zleceñ}
\label{fig:targets}
\end{figure}




\begin{figure}[H]
\centering
\begin{tabular}{@{}ll@{}}
a) & b) \\
\includegraphics[width=4cm]{rys04/details3} &
\includegraphics[width=4cm]{rys04/report}
\end{tabular}
\caption{a) Widok szczegó³ów zlecenia b) Okno dialogowe zg³aszania z³amania zasad}
\label{fig:details}
\end{figure}




\begin{figure}[H]
\centering
\includegraphics[width=4cm]{rys04/map}
\caption{Mapa znanych lokalizacji u¿ytkownika}
\label{fig:map}
\end{figure}





\begin{figure}[H]
\centering
\includegraphics[width=4cm]{rys04/drawer}
\caption{Panel nawigacyjny aplikacji}
\label{fig:drawer}
\end{figure}




\begin{figure}[H]
\centering
\includegraphics[width=4cm]{rys04/code}
\caption{Ekran Generowanie kodu}
\label{fig:code}
\end{figure}

\subsection{Panel administracyjny}\indent \par 


\section{Projekt bazy danych}\indent \par
\section{Protokó³ komunikacji w systemie}\indent \par
